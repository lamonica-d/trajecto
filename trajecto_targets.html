<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dominique Lamonica1,2">
<meta name="author" content="Hilaire Drouineau3">
<meta name="author" content="Hervé Capra1">
<meta name="author" content="Hervé Pella1">
<meta name="author" content="Jérémy Piffady1">
<meta name="author" content="Anthony Maire4">

<title>Classification of fish behavioral responses to environmental fluctuations in a large river</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="trajecto_targets_files/libs/clipboard/clipboard.min.js"></script>
<script src="trajecto_targets_files/libs/quarto-html/quarto.js"></script>
<script src="trajecto_targets_files/libs/quarto-html/popper.min.js"></script>
<script src="trajecto_targets_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="trajecto_targets_files/libs/quarto-html/anchor.min.js"></script>
<link href="trajecto_targets_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="trajecto_targets_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="trajecto_targets_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="trajecto_targets_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="trajecto_targets_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><p>Classification of fish behavioral responses to environmental fluctuations in a large river</p></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Dominique Lamonica<sup>1,2</sup> </p>
             <p>Hilaire Drouineau<sup>3</sup> </p>
             <p>Hervé Capra<sup>1</sup> </p>
             <p>Hervé Pella<sup>1</sup> </p>
             <p>Jérémy Piffady<sup>1</sup> </p>
             <p>Anthony Maire<sup>4</sup> </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>1 - INRAE, RiverLy, HYNES (Irstea-EDF R&amp;D), Villeurbanne, F-69625, France<br>
2 - IRD<br>
3 - INRAE, EABX, HYNES (Irstea-EDF R&amp;D), Cestas, F-33612, France<br>
4 - EDF R&amp;D, LNHE (Laboratoire National d’Hydraulique et Environnement), HYNES (Irstea - EDF R&amp;D), 6 quai Watier, 78401 Chatou Cedex, France<br>
<strong>Corresponding author:</strong> Dominique Lamonica, address: , email: dominique.lamonica@ird.fr<br>
<strong>Running title:</strong><br>
<strong>Word count:</strong> words</p>
<p><strong>Keywords:</strong></p>
<section id="description" class="level1">
<h1>Description</h1>
<p>This quarto file was produced to present the trajecto project. This file is supposed to be integrated in the target pipeline.</p>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p>These are the packages I used for my file <strong>test_targets.R</strong> file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(targets)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tarchetypes)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(visNetwork)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These are the packages I might use this file <em>.qmd</em>.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>These are the parameters to apply to this whole document (<strong>report_targets.qmd</strong>).</p>
</section>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Movement is a key feature of living organisms, affecting many ecological processes. In the last decades, the development of individual marking and tracking methods and related analytical methods have revolutionised behavioural ecology , especially movement ecology, which studies the link between the environment, organism internal states and their resulting movement. Most movements relate to the need for resources such as food or mates . Station keeping refer to small scale movements within the home range of individuals. It includes forging, i.e.&nbsp;a small scale and generally regular movement to find appropriate resource. It also included the defence of the habitat or predation avoidance and do not require complex orientation and navigation systems <span class="citation" data-cites="dingle2006">[@dingle2006]</span>. On the other hand, ranging refers to larger scale exploratory movements outside the home range to find more suitable habitats, that stop when the appropriate resources are found . Lastly, migration refer to an oriented compulsory movement outside the home range, occurring on a seasonal basis with a return movement . Analysing individual movements can inform on their behaviours and on their habitats needs. More importantly, movements can be used to assess the perturbations due to anthropogenic modifications of habitats.</p>
<p>Rivers provide multiple ecosystem services, but are heavily anthropised and modified by the implementation of dams or weirs, by water intake/outake, regulation of discharges, modification of habitats ... . At large temporal and spatial scales, Arevalo et al. show how global change have modified the thermal and discharge regimes of rivers, and how such modifications can in turn impact habitats suitability by fish . At a smaller spatial scale, the modifications of water velocity or thermal regimes due to anthropogenic pressures also modify the spatial distribution of fishes permanently or temporarily . At both scales, both intraspecific and interspecific variabilities are observed. High resolution trajectories data appears very relevant to improve our understanding of the responses of fishes to natural of human-induced variations in environmental conditions. Many dedicated methods and models have been developed to analysis such data. They would allow quantifying the changes behaviours and habitat use and explore for the existence of patterns of responses.</p>
<p>Yet, contrary to lakes or marine ecosystems, there is only a few studies investigating the influence on local environment in river on fish through the analysis of their trajectories. Many of these analysis focus on fish migration to assess the impacts of dams and weirs . Indeed, specific difficulties of movement data acquisition/defects of available data and data analysis are encountered in rivers. Most positioning systems use a triangulation procedure which is highly sensitive to regularities in banks profiles and ground irregularities . As such, the precision is spatially very variable . Moreover, contrary to open systems, rivers are highly anisotropic with banks and flow direction constraining fish movements . Given all these specificities, Lamonica et al.&nbsp;developed a specific framework to preprocess fish trajectories data aiming to address these limitations and then, to facilitate the exploration of the impacts of environmental conditions on fish behaviours.</p>
<p>Behavioural ecology has shown intraspecies variability in habitat preference and use (refs). This compels several processes of the population dynamics (dev un peu). Similarly, variations in species response to environmental changes can impact the community diversity, distribution and abundance (refs?). To investigate individual behaviour response to local environment variations, movement data appear to be an appropriate window. Several statistical and modelling tools are available to analyse and link movement data to individual behaviour (Gurarie2016). In particular, state-space models are widely used, and they offer the possibility of integrating environmental influence on switching probabilities between behavioural states (dev examples/refs).</p>
<p>In this paper, we propose to assess: 1) the effect of local environmental factors on behaviour change of individuals among freshwater fish species, and 2) the inter- and intraspecies variability of the response to environmental variations. We chose three freshwater species (chubs, barbel and catfish) and we focused on three major environmental factors, namely water depth, flow velocity and water temperature (why those factors + ref plichard2017). Our hypotheses are the following:.<br>
We developed a movement state-space model describing the effect of flow velocity, water depth and water temperature on behavioural change probabilities to investigate the variations in the effect of local environment on individual habitat use of freshwater fish (Figure 1). Movement data was derived from observed telemetry data, <em>i.e.</em> location and time, and local environment input data was simulated using a 2D hydraulic model. For each individual, independently model parameters were inferred within a Bayesian framework. Behavioural change probability functions were computed with the posterior distributions of parameters describing the effect of environment on behavioural change. For each environmental variable, independent classifications were then performed to classify individuals based on probability function shapes which describe their responses to a change in this environmental variable.<br>
</p>
</section>
<section id="materials-and-methods" class="level1">
<h1>Materials and Methods</h1>
<section id="study-area" class="level2">
<h2 class="anchored" data-anchor-id="study-area">Study area</h2>
<p>The study river section is located on the Rhône river and is 1.8km long and 140m wide (at a mean discharge of 465m<sup>3</sup> s<sup>-1</sup>). This river section is situated 363km upstream from the river mouth, near the Bugey nuclear power plant 45°47’44”N; 5°16’25”E. The power plant abstracts c.a. 100m<sup>3</sup> s<sup>-1</sup> at the upstream end of our study reach to cool its four reactors, and releases warmed water (between 7°C and 10°C warmer than the upstream water) at two different locations , creating a temperature difference between the left and the right bank. More details on the study site can be found in Plichard2017.</p>
</section>
<section id="data-collection-and-simulation" class="level2">
<h2 class="anchored" data-anchor-id="data-collection-and-simulation">Data collection and simulation</h2>
<section id="movementtrajectory-data" class="level3">
<h3 class="anchored" data-anchor-id="movementtrajectory-data">Movement/trajectory data</h3>
<p>Bergé et al.&nbsp;collected telemetry data on 94 freshwater fish individuals of X species in the Rhône river using an HTI (<a href="https://www.innovasea.com/fish-tracking/" class="uri">https://www.innovasea.com/fish-tracking/</a>) acoustic fixed telemetry system with X hydrophones positioned on the riverbed <span class="citation" data-cites="Berge2012">[@Berge2012]</span>. Locations of these individuals have been tracked during three months at a period of three seconds. Each tag emits a specific acoustic signal/at a specific frequency that allows the identification of fish individual and precise positioning through a triangulation process, provided that the signal is detected by at least 3 hydrophones. Those data have been pre-treated according to the method presented in Lamonica2020 to handle usual defects of telemetry data (small and large gaps in location recording, and specific artefactual patterns in some trajectories due to the triangulation process of the HTI system). For each individual, we obtained a set of independent trajectories with locations regularly spaced in time (1 minute). We selected the individuals which have been located more than xx hours (number of locations), namely 4 individuals of barbel <em>Barbus barbus</em>, 8 individuals of European chub <em>Squalius cephalus</em> and 6 individuals of European catfish <em>Silurus glanis</em>.</p>
</section>
<section id="data-acquisition" class="level3">
<h3 class="anchored" data-anchor-id="data-acquisition">Data acquisition</h3>
<p>Show the data frame of clean data for each individuals</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_load</span>(data_for_inference)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>✖ Identified no targets to load.</code></pre>
</div>
</div>
</section>
<section id="environment-data" class="level3">
<h3 class="anchored" data-anchor-id="environment-data">Environment data</h3>
<p>A two-dimensional unsteady hydraulic model of the reach considering the longitudinal and lateral variations of depth-averaged velocities and accounting for discharge variations have been used to simulate fish local environment (Telemac 2D model, calibration details in Capra et al., 2011). The Telemac 2D model also had a component that allowed us to simulate water temperature conditions across the reach (Hervouet, 1999) . For each time and location of each individual, depth-averaged velocity (<span class="math inline">\(V\)</span>, m.s<sup>-1</sup>), water depth (<span class="math inline">\(D\)</span>, m) and the difference between the local water temperature and the water temperature recorded upstream of the study section (<span class="math inline">\(T\)</span>, <span class="math inline">\(^{\circ}\)</span>C) have been simulated. Then those three variables have been normalised across all individuals and locations in order to compare the effect of the variables between individuals and between the variables themselves on fish movement/behaviour.</p>
</section>
</section>
<section id="state-space-model-parameter-inference" class="level2">
<h2 class="anchored" data-anchor-id="state-space-model-parameter-inference">State space model + parameter inference</h2>
<section id="state-space-modelling" class="level3">
<h3 class="anchored" data-anchor-id="state-space-modelling">State-space modelling</h3>
<p>We developed a state-space model based on Lamonica2020 aiming at discriminating the different individual behaviours displayed by an individual during its trajectories, and at describing how fishes switch between those behaviours as a response to environmental cues. Model states correspond to the succession of fish behaviours at each time-step, with two possible behaviours: “Resting” (denoted by <span class="math inline">\(R\)</span>) which corresponds to slow or erratic short-distance movements, and “Moving” (denoted by <span class="math inline">\(M\)</span>) which corresponds to fast oriented movements (Lamonica2020). We assumed a quadratic influence of each environmental variable on the behaviour switching probabilities between each time-step, with a logit link to map the quadratic linear function to switching probabilities . The quadratic function allows for non-linear relationships, especially dome-shape relationships, between environmental factors and behaviour changes. We also added a fixed effect of the nychthemeral period (day, dust, dawn, night) to account for possible different levels of activity throughout the day. The observation model links the state at time <span class="math inline">\(t\)</span> to corresponding movement variables (<em>i.e.</em> speed between two locations and turning angles between two moves) and two additional variables which summarize the raw data to help discriminating between behaviours Lamonica2020. The model is written as follows:<br>
Transition matrix <span class="math display">\[M_{q}(t)=
\begin{pmatrix}
   1-q_{R \rightarrow M}(t) &amp;q_{R \rightarrow M}(t) \\
   q_{M \rightarrow R}(t)&amp;1-q_{M \rightarrow R}(t)
\end{pmatrix}\]</span></p>
<p><span class="math display">\[\text{logit}(q_{R \rightarrow M}(t)) = M_{a} \times M_{E}(t)\]</span></p>
<p><span class="math display">\[\text{logit}(q_{M \rightarrow R}(t)) = M_{b} \times M_{E}(t)\]</span></p>
<p>with <span class="math display">\[M_{a}=(a_{1}, ..., a_{11})\]</span></p>
<p><span class="math display">\[M_{b}=(b_{1}, ..., b_{11})\]</span> and</p>
<p><span class="math display">\[M_{E}(t)=
\begin{pmatrix}
   0 \\
   V(t) \\
   V^2(t) \\
   D(t) \\
   D^2(t) \\
   T(t) \\
   T^2(t) \\
   \mathbb{1}_{DAY}(t) \\
   \mathbb{1}_{DUST}(t) \\
   \mathbb{1}_{NIGHT}(t) \\
   \mathbb{1}_{DAWN}(t)
\end{pmatrix}\]</span></p>
<p>State equation <span class="math display">\[z_{t} \sim \mathcal{B}ernoulli(M_{q}(t)[z_{t-1}])\]</span> Observation model</p>
<p><span class="math display">\[\begin{array}{l}
y_{v_{t}} \sim \mathcal{G}amma(k[z_{t}], \theta[z_{t}])\\
y_{\phi_{t}} \sim \mathcal{V}on\mathcal{M}ises(m[z_{t}], \rho[z_{t}])\\
U_{1_{t}} \sim \mathcal{B}eta(\alpha[z_{t}], \beta[z_{t}])\\
U_{2_{t}} \sim \mathcal{N}ormal(\mu[z_{t}], \sigma[z_{t}])
\end{array}\]</span></p>
<p>with <span class="math inline">\(q_{R \rightarrow M}\)</span> and <span class="math inline">\(q_{M \rightarrow R}\)</span> the probability of switching from resting, respectively moving, behaviour to moving, respectively resting, behaviour, <span class="math inline">\(z_{t}\)</span> the behaviour at time <span class="math inline">\(t\)</span> (<span class="math inline">\(R\)</span> or <span class="math inline">\(M\)</span>). Parameters <span class="math inline">\(a_{1}\)</span> and <span class="math inline">\(b_{1}\)</span> are the intercepts of the switching probabilities, <span class="math inline">\(a_{2}\)</span> and <span class="math inline">\(b_{2}\)</span>, and <span class="math inline">\(a_{5}\)</span> and <span class="math inline">\(b_{5}\)</span> are the linear and quadratic coefficients related to flow velocity, <span class="math inline">\(a_{3}\)</span> and <span class="math inline">\(b_{3}\)</span>, and <span class="math inline">\(a_{6}\)</span> and <span class="math inline">\(b_{6}\)</span> are the linear and quadratic coefficients related to water depth, <span class="math inline">\(a_{4}\)</span> and <span class="math inline">\(b_{4}\)</span>, and <span class="math inline">\(a_{7}\)</span> and <span class="math inline">\(b_{7}\)</span> are the linear and quadratic coefficients related to temperature difference.<br>
Concerning the data, <span class="math inline">\(y_{v_{t}}\)</span> is the observed speed between <span class="math inline">\(t-1\)</span> and <span class="math inline">\(t\)</span> and <span class="math inline">\(y_{\phi_{t}}\)</span> is the observed turning angles between <span class="math inline">\(t-2\)</span> and <span class="math inline">\(t-1\)</span> and <span class="math inline">\(t-1\)</span> and <span class="math inline">\(t\)</span>, <span class="math inline">\(U_{1_{t}}\)</span> is the ratio between the covered distance from interpolated data and the covered distance from raw data between <span class="math inline">\(t-1\)</span> and <span class="math inline">\(t\)</span>, and <span class="math inline">\(U_{2_{t}}\)</span> is the variance of turning angles from raw data between <span class="math inline">\(t-1\)</span> and <span class="math inline">\(t\)</span>. Concerning parameters, <span class="math inline">\(k[z_{t}]\)</span> and <span class="math inline">\(\theta[z_{t}]\)</span> are the parameters describing the speed for behaviour <span class="math inline">\(z\)</span> at time <span class="math inline">\(t\)</span> and <span class="math inline">\(m[z_{t}]\)</span> and <span class="math inline">\(\rho[z_{t}]\)</span> are the parameters describing the turning angle for behaviour <span class="math inline">\(z\)</span> at time <span class="math inline">\(t\)</span>, with <span class="math inline">\(\alpha[z_{t}]\)</span> and <span class="math inline">\(\beta[z_{t}]\)</span> the parameters describing <span class="math inline">\(U_{1}\)</span> for behaviour <span class="math inline">\(z\)</span> at time <span class="math inline">\(t\)</span>, <span class="math inline">\(\mu[z_{t}]\)</span> and <span class="math inline">\(\sigma[z_{t}]\)</span> the parameters describing <span class="math inline">\(U_{2}\)</span> for behaviour <span class="math inline">\(z\)</span> at time <span class="math inline">\(t\)</span>.</p>
</section>
<section id="parameter-inference" class="level3">
<h3 class="anchored" data-anchor-id="parameter-inference">Parameter inference</h3>
<p>Bayesian inference was used to fit the model to the data independently for each individual. We defined prior distributions summarising all available information on each parameter (see SI Table xx). Markov Chain Monte Carlo (MCMC) computations were performed using JAGS software and the <em>rjags</em> R package. A total of 5,000 iterations were performed as a burn-in phase and inference was based on 20,000 to 70,000 additional iterations, depending on the individual, for each of the three independent chains. We used the Gelman and Rubin tests to check the convergence of the estimation process.</p>
</section>
</section>
<section id="clustering-of-fishes" class="level2">
<h2 class="anchored" data-anchor-id="clustering-of-fishes">Clustering of fishes</h2>
<p>We aimed at classifying the response of individuals to environmental factors in terms of behavioral change, <em>i.e.</em> based on how the probability of behaviour change varies along the environmental gradient. For that we used the derivative of the probability functions according to the target environmental variable, with the two other variables fixed to zero (<em>i.e.</em> at their average value). The general form of the derivative function for the environmental variable <span class="math inline">\(X\)</span> is thus written as follow: <span class="math display">\[\frac{(c + 2\times d\times X)\exp(a + b + c\times X + d\times X^2)}{\exp(a + b + c\times X + d\times X^2) + 1} -
\frac{(c + 2\times d\times X)\exp(2\times (a + b) + 2\times c\times X + 2\times d\times X^2)}{(\exp(a + b + c\times X + d\times X^2) + 1)^2}\]</span> with <span class="math inline">\(a\)</span> the intercept of the considered switching probability (from Resting to Moving <span class="math inline">\(q_{R \rightarrow M}\)</span>, or Moving to Resting <span class="math inline">\(q_{M \rightarrow R}\)</span>), <span class="math inline">\(b\)</span> the coefficient of the nychthemeral period fixed effect, <span class="math inline">\(c\)</span> and <span class="math inline">\(d\)</span> being the linear and quadratic coefficients respectively, relative to the considered environmental variable <span class="math inline">\(X\)</span> (flow velocity <span class="math inline">\(V\)</span>, water depth <span class="math inline">\(D\)</span>, or water temperature difference <span class="math inline">\(T\)</span>).<br>
Six independent classifications were performed, <em>i.e.</em> two behaviour changing probabilities X three environmental variables. To carry out a clustering analysis, a metric is required to quantify the distance/similarity between each pair of functions. In this aim, we calculated for each pair of fucntions the absolute area between the two curves, restrained on the main part of the environmental gradient (x-axis range of standardised environmental variable = <span class="math display">\[-1.5; 1.5\]</span>), using area between curve function from the <em>geiger</em> R package (ref).<br>
In order to take into account the uncertainties in estimates of the transition matrix coefficients, we performed the classification using <span class="math inline">\(n\)</span> replicates for each individual. Those replicates were generated by randomly selecting <span class="math inline">\(n\)</span> iterations of the posterior distributions, leading to <span class="math inline">\(n\)</span> values of the transition matrix coefficients which have been used to compute <span class="math inline">\(n\)</span> derivative functions per individual, according to equation (6).<br>
For each of the 6 independent classifications, we performed hierarchical clustering using whatever function from whatever R package (ref). We set the number of classes according to inertia decrease (ref?) (see SI figure Ax). Each replicate of each individual fell into a class. To assign an individual to a class, we selected the one where most of the replicates fell into.</p>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="nychthemeral-period-effect" class="level2">
<h2 class="anchored" data-anchor-id="nychthemeral-period-effect">Nychthemeral period effect</h2>
<p>For all individuals and for both switching behaviour probabilities, at least the coefficient of the fixed effect for one nychthemeral period was significantly different from the others (ANOVA SI Table 2, Figure S2). However, the coefficients of nychthemeral period fixed effects showed no general pattern. We chose to focus the results on the switching probabilities computed for the day.</p>
</section>
<section id="general-effect-of-the-environment" class="level2">
<h2 class="anchored" data-anchor-id="general-effect-of-the-environment">General effect of the environment</h2>
<p>Outside of the extreme range of environmental values, median switching probabilities were below 0.5 (SI Figure S4), suggesting that individuals tend to stay in the same behaviour. Overall, the effect of the water temperature difference on switching probabilities was weaker than the effect of water depth and flow velocity, as suggested by the boxplots of the linear and quadratic coefficients being closer to zero for temperature difference (SI Figure S3). Hence, the median switching probabilities were less variable, almost constant, with temperature difference for all individuals (SI Figure S4). Consequently, we performed the classification on switching probabilities functions only for water depth and flow velocity. For those two environmental factors, there was no general pattern: probability functions were found to be monotonously increasing or decreasing, or bell shaped concave or convex (SI Figure S4). Simulated responses to water depth and flow velocity (with temperature difference equal to 0) for the value ranges encountered by each individual are showed Figure 2. Overall, in the extreme values of the environmental gradient, the probability of behaviour switch/change increases, in particular from resting to moving. However, for some individuals one or both switching probabilities showed very little variations according to the environmental factors.</p>
</section>
<section id="inter--and-intra-species-variability" class="level2">
<h2 class="anchored" data-anchor-id="inter--and-intra-species-variability">Inter- and intra-species variability</h2>
<p>For the probability to switch from moving to resting according to flow velocity, three groups were identified (Figure 3a): the individuals from group one (red) showed an increasing then slightly decreasing probability, the individuals from the second group (green) showed the inverse pattern, while for the third group (blue) the probability showed little variations. For the probability to switch from resting to moving according to flow velocity, four groups were identified (Figure 3b): the individuals from group one (red) showed a concave parabolic probability, the third group (blue) showed the inverse pattern, the individuals from the second group (green) showed a decreasing probability. For the probability to switch from moving to resting according to water depth, two groups were identified (Figure 3c): the individuals from group one (red) showed a concave parabolic probability, the individuals from the second group (blue) showed a convex parabolic probability or less variations. For the probability to switch from resting to moving according to water depth, three groups were identified (Figure 3d): the individuals from group one (red) showed a concave parabolic probability, the third group (blue) showed the inverse pattern, while for the second group (blue) the probability was overall steadily increasing.<br>
Overall, classification of switching probability functions according to water depth or flow velocity did not allow to identify any species- or size- specific patterns (Figure 3). In addition, the groups were not consistent across the couples probability-environmental factor, suggesting that there is no pattern in the global response to the environmental conditions.</p>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<ul>
<li><p>what do those probability transitions mean ecologically, for the fish behaviour ?</p></li>
<li><p>how can we interpret the effect of environment according to habitat preferences and what we know about those species ecology ?</p></li>
<li><p>such an individual variability that we can not see any species/size patterns, given the limitations of the experiment. develop on exp limitations (river, telemetry, size of the section, loss of the signal, etc.)</p></li>
</ul>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<ul>
<li><p>summary of results/interpretations: minor effect of water temperature difference compared to flow velocity and water depth + no general pattern in the local environment effect, strong inter individual variability + no group pattern + it seems that individual preferences, or/and other local environmental factors, are the major driver of behaviour changes.</p></li>
<li><p>perspectives: the model can help inferring/predicting in which behavioral state is/will be an individual, as well as changes in behaviour. In an environment with such a high anthropic pressure, knowing those behaviour modifications is helpful to assess how disturbed the individuals can be.</p></li>
</ul>
</section>
<section id="figures" class="level1">
<h1>Figures</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>